# 电商订单系统 V3.0 性能测试报告

**报告编号**：PERF-ORDER-20250830

**测试周期**：2025-08-28 09:00 至 2025-08-29 18:00

**测试对象**：电商订单系统 V3.0（预发环境集群）

**测试团队**：性能测试组

**核心结论**：系统经优化后，1000 并发下核心性能指标均超目标（QPS 达 920、成功率 99.95%），2000 并发预演可支撑业务峰值需求，仅需短期扩容 MySQL 连接池即可应对双 11 压力。

## 一、报告概述

### 1.1 测试目标



1.  验证**1000 并发用户下单**场景下，订单系统的性能表现（QPS、响应时间、成功率等）是否满足业务需求；

2.  定位系统性能瓶颈，输出可落地的优化方案并验证效果；

3.  预演**2000 并发峰值**（模拟双 11 业务量），评估系统极限支撑能力，制定容量规划建议。

### 1.2 测试范围



*   **核心业务链路**：商品查询→库存扣减→订单创建→支付回调（全链路闭环）；

*   **覆盖组件**：应用服务（订单 / 商品 / 库存服务）、中间件（MySQL 8.0、Redis 6.2）、基础设施（应用服务器、数据库服务器）；

*   **排除范围**：物流对接、短信通知等非核心附属功能。

### 1.3 数据来源



*   压测工具：JMeter 5.6（10 台压测机，模拟用户并发请求）；

*   监控工具：Prometheus（1 秒级指标采集）、Grafana（可视化）、ELK（故障日志存储）、SkyWalking（全链路追踪）；

*   环境数据：预发环境与生产环境架构一致，测试数据量匹配生产（订单表 100 万条、商品表 50 万条）。

## 二、测试环境与设计

### 2.1 测试环境配置



| 层级         | 配置详情                                                              | 数量   |
| ---------- | ----------------------------------------------------------------- | ---- |
| **应用服务器**  | 型号：Dell R750；CPU：32 核 Intel Xeon 8375C；内存：64GB DDR4；系统：CentOS 7.9 | 8 台  |
| **数据库服务器** | 型号：Dell R940；CPU：32 核；内存：64GB；存储：1TB SSD；MySQL 8.0.32（主从架构）       | 2 台  |
| **缓存服务器**  | 型号：Dell R750；CPU：16 核；内存：32GB；Redis 6.2.6（单节点，开启持久化）              | 1 台  |
| **软件环境**   | 应用框架：Spring Boot 2.7.8；Web 容器：Tomcat 9；负载均衡：Nginx 1.21            | -    |
| **压测工具**   | JMeter 5.6；压测机配置：8 核 16GB；单台最大并发：100 用户                           | 10 台 |

### 2.2 测试设计

#### 2.2.1 测试场景



| 场景类型   | 场景描述                          | 并发数          | 持续时间      | 核心验证点                 |
| ------ | ----------------------------- | ------------ | --------- | --------------------- |
| 基准测试   | 100 并发用户下单（低负载验证稳定性）          | 100          | 10 分钟     | 系统无错误、指标波动≤5%         |
| 负载测试   | 500/800/1000 并发阶梯加压（验证业务承载能力） | 500→800→1000 | 每阶梯 30 分钟 | 各并发下 QPS、响应时间、成功率是否达标 |
| 压力测试   | 1000→1200→1500 并发持续加压（探极限）    | 1000→1500    | 每阶梯 20 分钟 | 系统崩溃阈值、极限 QPS         |
| 稳定性测试  | 1000 并发持续运行 2 小时（验证长期可靠性）     | 1000         | 120 分钟    | 内存泄漏、连接泄漏、指标漂移情况      |
| 峰值预演测试 | 2000 并发模拟双 11 峰值（评估扩容需求）      | 2000         | 30 分钟     | 核心指标是否满足峰值业务需求        |

#### 2.2.2 性能目标

基于业务需求（日常 1000 并发、双 11 2000 并发）制定以下目标：



| 指标类别   | 具体指标             | 1000 并发目标值 | 2000 并发目标值 |
| ------ | ---------------- | ---------- | ---------- |
| 业务指标   | 订单创建成功率（%）       | ≥99.9      | ≥99.5      |
|        | 订单 QPS           | ≥800       | ≥1500      |
|        | 95% 响应时间（ms）     | ≤100       | ≤150       |
|        | 接口错误率（%）         | ≤0.1       | ≤0.5       |
| 中间件指标  | MySQL 平均查询耗时（ms） | ≤100       | ≤120       |
|        | Redis 缓存命中率（%）   | ≥90        | ≥90        |
| 基础设施指标 | CPU 使用率（%）       | ≤80        | ≤85        |
|        | 内存使用率（%）         | ≤75        | ≤80        |

## 三、测试执行与结果总览

### 3.1 测试执行流程



1.  **环境准备**：预发环境部署订单系统 V3.0，初始化测试数据（订单 100 万条、商品 50 万条），确认监控工具（Prometheus/Grafana/ELK）正常运行；

2.  **阶梯加压**：按 “100→500→800→1000→1200→1500” 并发阶梯执行，每阶梯稳定 30 分钟，采集指标数据；

3.  **瓶颈定位**：当指标不达标时（如 1000 并发 QPS 仅 300），结合 ELK 故障日志、SkyWalking 链路追踪定位瓶颈；

4.  **优化验证**：实施优化方案后，重复 1000 并发测试，对比优化前后指标；

5.  **峰值预演**：优化后执行 2000 并发测试，评估峰值支撑能力。

### 3.2 核心性能结果总览（优化前 vs 优化后）

#### 3.2.1 1000 并发测试结果对比



| 指标类别       | 具体指标             | 优化前（不达标项） | 优化后（达标情况） | 目标值   | 改善幅度     |
| ---------- | ---------------- | --------- | --------- | ----- | -------- |
| **业务指标**   | 订单创建成功率（%）       | 98.5（不达标） | 99.95（达标） | ≥99.9 | ↑1.47%   |
|            | 订单 QPS           | 300（不达标）  | 920（达标）   | ≥800  | ↑206.67% |
|            | 95% 响应时间（ms）     | 500（不达标）  | 80（达标）    | ≤100  | ↓84%     |
|            | 接口错误率（%）         | 1.2（不达标）  | 0.03（达标）  | ≤0.1  | ↓97.5%   |
| **中间件指标**  | MySQL 平均查询耗时（ms） | 5800（不达标） | 80（达标）    | ≤100  | ↓98.62%  |
|            | Redis 缓存命中率（%）   | 75（不达标）   | 93（达标）    | ≥90   | ↑24%     |
| **基础设施指标** | CPU 使用率（%）       | 96（不达标）   | 45（达标）    | ≤80   | ↓53.13%  |
|            | 内存使用率（%）         | 95（不达标）   | 65（达标）    | ≤75   | ↓31.58%  |

#### 3.2.2 2000 并发预演结果（优化后）



| 指标              | 预演实际值 | 2000 并发目标值 | 达标情况 | 风险预判        |
| --------------- | ----- | ---------- | ---- | ----------- |
| 订单 QPS          | 1750  | ≥1500      | 达标   | 无           |
| 95% 响应时间（ms）    | 120   | ≤150       | 达标   | 无           |
| 订单创建成功率（%）      | 99.6  | ≥99.5      | 达标   | 无           |
| MySQL 连接池使用率（%） | 75    | ≤80        | 达标   | 2500 并发可能超标 |
| CPU 使用率（%）      | 78    | ≤85        | 达标   | 2500 并发可能超标 |

## 四、性能瓶颈分析（优化前）

通过监控告警与故障日志分析，优化前共识别 4 类瓶颈，按业务影响优先级排序如下：

### 4.1 P0 级瓶颈（致命影响）

#### 4.1.1 MySQL 订单表慢查询



*   **现象**：1000 并发下，MySQL 慢查询频次达 30 次 / 分钟，订单查询耗时从正常 80ms 飙升至 5.8s；

*   **根因**：订单表未创建 “user\_id+create\_time” 联合索引，用户查询历史订单时触发全表扫描（扫描行数 10 万），占用大量数据库连接；

*   **影响**：MySQL 连接池使用率达 95%，新订单无法获取连接，成功率降至 98.5%，QPS 从 800 骤降至 300。

#### 4.1.2 JVM 内存泄漏（订单服务）



*   **现象**：压测 10 分钟后，订单服务堆内存使用率达 95%，Full GC 5 次 / 5 分钟，STW 总时长 5000ms；

*   **根因**：`OrderCache`缓存未设置过期时间与容量限制，1000 并发下缓存对象累积 1.2GB，老年代内存耗尽；

*   **影响**：应用线程因 GC 阻塞，CPU 使用率升至 96%，订单处理 TPS 从 150 降至 50。

### 4.2 P1 级瓶颈（影响性能）

#### 4.2.1 Redis 缓存命中率低



*   **现象**：商品查询 QPS=500 时，Redis 命中率仅 75%，未命中请求导致 MySQL 读 QPS 达 600；

*   **根因**：缺少 “分类商品列表” 缓存键，且库存更新后未同步刷新缓存，导致大量请求直接查询数据库。

#### 4.2.2 应用服务器 CPU 高负载



*   **现象**：3 台订单服务 CPU 使用率达 96%，其中 GC 线程占用 40%；

*   **根因**：JVM 频繁 Full GC+MySQL 慢查询导致线程阻塞，CPU 资源被无效占用。

## 五、优化方案及效果验证

### 5.1 核心优化措施



| 瓶颈类型       | 优化措施                                                                 | 实施周期 | 责任人     |
| ---------- | -------------------------------------------------------------------- | ---- | ------- |
| MySQL 慢查询  | 1. 订单表添加 “user\_id+create\_time” 联合索引；2. 优化 SQL（去掉`select *`，只查必要字段） | 1 天  | 开发 - 李工 |
| JVM 内存泄漏   | 1. `OrderCache`设置 30 分钟过期 + 5000 条容量限制；2. 启用 LRU 淘汰策略；3. 调整 G1 GC 参数 | 1 天  | 开发 - 王工 |
| Redis 命中率低 | 1. 新增 “分类商品列表” 缓存键（`goods:category:{cat_id}`）；2. 实现库存更新后缓存刷新         | 1 天  | 开发 - 张工 |
| CPU 高负载    | 优化上述瓶颈后，CPU 资源自动释放（无需额外操作）                                           | -    | -       |

### 5.2 优化效果深度验证

#### 5.2.1 1000 并发优化效果（关键指标对比）



| 指标                | 优化前       | 优化后      | 目标值       | 达标率  | 业务价值                                 |
| ----------------- | --------- | -------- | --------- | ---- | ------------------------------------ |
| 订单 QPS            | 300       | 920      | 800       | 115% | 单小时订单处理能力从 108 万升至 331 万，支撑日常 3 倍业务量 |
| 95% 响应时间（ms）      | 500       | 80       | 100       | 125% | 用户下单等待时间缩短 84%，体验接近 “瞬时响应”           |
| MySQL 慢查询数        | 30 次 / 分钟 | 0 次 / 分钟 | ≤5 次 / 分钟 | 200% | 数据库连接池空闲率从 5% 升至 60%，资源利用率大幅提升       |
| Full GC 次数（30 分钟） | 10        | 1        | ≤1        | 100% | 应用无卡顿，服务稳定性提升 10 倍                   |

#### 5.2.2 2000 并发峰值支撑能力

优化后 2000 并发预演显示：



*   核心指标均达标（QPS=1750、成功率 99.6%、95% 响应时间 120ms）；

*   潜在风险：MySQL 连接池使用率 75%（接近 80% 阈值）、CPU 使用率 78%（接近 85% 阈值）；

*   应对方案：短期扩容 MySQL 连接池至 150，新增 2 台应用服务器；长期实施订单表分库分表。

## 六、风险预警与建议

### 6.1 潜在风险



1.  **峰值并发风险**：双 11 若出现 2500 + 并发，MySQL 连接池与 CPU 可能超标，导致订单处理延迟；

2.  **缓存雪崩风险**：Redis 集群若宕机，当前缓存架构（本地缓存 + Redis）可支撑 10 分钟，但需快速恢复；

3.  **数据量增长风险**：订单表若增至 500 万条，未分表前可能重现查询缓慢。

### 6.2 建议措施



| 类型           | 建议内容                                                                                  | 实施时间         |
| ------------ | ------------------------------------------------------------------------------------- | ------------ |
| 短期建议（1 周内）   | 1. 扩容 MySQL 连接池至 150；2. 新增 2 台应用服务器（32 核 64GB）；3. 备份 Redis 数据，启用哨兵模式                  | 2025-09-05 前 |
| 长期建议（1-3 个月） | 1. 订单表按 “user\_id 哈希” 分 8 个分表；2. 搭建 Redis 集群（3 主 3 从）；3. 建立性能常态化测试机制（每周 1 次 500 并发测试） | 2025-10-30 前 |

## 七、测试结论



1.  **性能达标情况**：电商订单系统 V3.0 经优化后，1000 并发下核心指标**100% 达标**，2000 并发预演**90% 达标**（仅需短期扩容即可完全满足双 11 峰值需求）；

2.  **核心优化价值**：通过 “索引优化 + 缓存策略调整 + JVM 调优”，系统订单处理能力提升 206%，响应时间缩短 84%，稳定性显著增强；

3.  **业务支撑能力**：优化后系统单小时可处理 331 万订单，可支撑日常业务 3 倍峰值，双 11 2000 并发下可保障 99.6% 的订单成功率，满足业务增长需求。

**建议**：按短期建议完成扩容后，系统可正式上线；长期需推进分库分表与 Redis 集群建设，进一步提升系统扩展性。

> （注：文档部分内容可能由 AI 生成）