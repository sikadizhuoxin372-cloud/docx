# 性能测试环境拓扑图（通用架构）

以下拓扑图覆盖  **“客户端→网络→应用→数据” 全链路** ，适配 Web / 移动端 / 服务端项目，可根据实际技术栈（如容器化、微服务、云架构）调整节点。

## 一、拓扑图结构（文字版分层示意）

plaintext

```plaintext
 ┌─────────────────────────────────────────────────────────────────────┐
│                          客户端层（压测发起端）                      │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │
│  │  压测工具节点1 │  │  压测工具节点2 │  │  压测工具节点N │            │
│  │  （JMeter/LoadRunner）│ （JMeter/LoadRunner）│ （JMeter/LoadRunner）│
│  └───────────────┘  └───────────────┘  └───────────────┘            │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          网络层（模拟真实环境）                      │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │
│  │  负载均衡器   │  │  防火墙/安全组 │  │  网络带宽控制 │            │
│  │  （Nginx/HAProxy）│ （端口/IP过滤）│ （模拟带宽限制）│            │
│  └───────────────┘  └───────────────┘  └───────────────┘            │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          应用层（核心业务处理）                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                     前端服务集群（可选）                      │  │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐     │  │
│  │  │  前端节点1    │  │  前端节点2    │  │  前端节点N    │     │  │
│  │  │ （静态资源/SPA）│ （静态资源/SPA）│ （静态资源/SPA）│     │  │
│  │  └───────────────┘  └───────────────┘  └───────────────┘     │  │
│  └───────────────────────────────┬───────────────────────────────┘  │
│                                  │                                  │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                     后端服务集群（核心）                      │  │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐     │  │
│  │  │  服务节点1    │  │  服务节点2    │  │  服务节点N    │     │  │
│  │  │ （API/业务逻辑）│ （API/业务逻辑）│ （API/业务逻辑）│     │  │
│  │  └───────────────┘  └───────────────┘  └───────────────┘     │  │
│  └───────────────────────────────┬───────────────────────────────┘  │
│                                  │                                  │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                     中间件层（支撑服务）                      │  │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐     │  │
│  │  │  缓存集群     │  │  消息队列     │  │  分布式锁     │     │  │
│  │  │  （Redis/Memcached）│ （Kafka/RabbitMQ）│ （Redis/ZooKeeper）│     │  │
│  │  └───────────────┘  └───────────────┘  └───────────────┘     │  │
│  └───────────────────────────────────────────────────────────────┘  │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          数据层（存储核心）                          │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │
│  │  数据库集群   │  │  数据备份节点 │  │  日志存储     │            │
│  │  （MySQL主从/分库分表）│ （定时备份/灾备）│ （ELK/ClickHouse）│            │
│  └───────────────┘  └───────────────┘  └───────────────┘            │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          监控层（全链路观测）                          │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │
│  │  系统监控     │  │  应用监控     │  │  性能指标展示 │            │
│  │  （CPU/内存/网络）│ （JVM/接口耗时）│ （Grafana/Dashboard）│            │
│  └───────────────┘  └───────────────┘  └───────────────┘            │
└─────────────────────────────────────────────────────────────────────┘
```

## 二、各层核心节点说明

| 层级     | 核心节点        | 作用说明                                                                 | 常见组件 / 工具                                        |
| -------- | --------------- | ------------------------------------------------------------------------ | ------------------------------------------------------ |
| 客户端层 | 压测工具节点    | 模拟真实用户发起并发请求，生成负载压力（避免单节点性能瓶颈影响压测结果） | JMeter、LoadRunner、Gatling                            |
| 网络层   | 负载均衡器      | 分发请求到后端服务节点，模拟生产环境的流量分发逻辑                       | Nginx、HAProxy、云厂商 SLB（如阿里云 SLB）             |
|          | 防火墙 / 安全组 | 模拟生产环境的端口限制、IP 过滤规则，确保测试环境安全性                  | iptables、云厂商安全组                                 |
|          | 网络带宽控制    | 模拟不同网络环境（如 4G/5G / 宽带），测试弱网下的系统表现                | tc（Linux 流量控制）、Fiddler                          |
| 应用层   | 前端服务节点    | 提供静态资源（HTML/CSS/JS）或 SPA 应用，模拟前端部署架构                 | Nginx（静态资源）、Node.js（前端服务）                 |
|          | 后端服务节点    | 处理核心业务逻辑（API 接口、事务处理），通常以集群形式部署提升性能       | Spring Boot、Go 微服务、Python Flask                   |
| 中间件层 | 缓存集群        | 缓存高频访问数据（如用户信息、商品列表），减少数据库压力                 | Redis 集群、Memcached                                  |
|          | 消息队列        | 解耦服务间通信（如订单创建→库存扣减），削峰填谷提升系统稳定性           | Kafka、RabbitMQ、RocketMQ                              |
|          | 分布式锁        | 解决分布式环境下的并发问题（如秒杀库存扣减）                             | Redis 分布式锁、ZooKeeper                              |
| 数据层   | 数据库集群      | 存储业务数据，通常采用主从复制、分库分表提升读写性能和可用性             | MySQL 主从、PostgreSQL 集群、MongoDB                   |
|          | 数据备份节点    | 模拟生产环境的备份策略，避免测试数据丢失                                 | MySQL 从库（备份用）、定时快照                         |
|          | 日志存储        | 收集全链路日志（请求日志、错误日志），用于压测后问题排查                 | ELK Stack（Elasticsearch+Logstash+Kibana）、ClickHouse |
| 监控层   | 系统监控节点    | 采集服务器硬件指标（CPU、内存、磁盘 I/O、网络）                          | Prometheus+node_exporter、nmon                         |
|          | 应用监控节点    | 采集应用性能指标（接口耗时、JVM 内存、GC 情况）                          | Prometheus+jvm_exporter、SkyWalking                    |
|          | 性能指标展示    | 可视化展示压测指标（TPS、响应时间、错误率），实时观测系统状态            | Grafana、JMeter Dashboard                              |

## 三、不同架构的拓扑调整建议

1. **容器化 / 云原生架构** ：

* 在 “应用层” 增加  **Kubernetes 集群** （Master+Node 节点），后端服务 / 中间件以 Pod 形式部署；
* 网络层增加  **Ingress 控制器** （如 Nginx Ingress），替代传统负载均衡器。

1. **微服务架构** ：

* 在 “后端服务集群” 与 “中间件层” 之间增加  **服务注册与发现** （如 Nacos、Eureka）、 **API 网关** （如 Spring Cloud Gateway、Kong）；
* 监控层增加  **分布式追踪系统** （如 Jaeger、Zipkin），追踪跨服务调用链路耗时。

1. **单机测试环境（轻量化）** ：

* 合并 “压测工具节点”“前端服务”“后端服务” 到同一台服务器（仅用于低并发测试）；
* 数据层用 “单机数据库 + 本地缓存”（如 Redis 单机版），省略集群节点。

## 四、拓扑图绘制工具推荐

* 在线工具：Draw.io（免费、支持分层绘制）、ProcessOn（模板丰富）；
* 本地工具：Visio（Windows）、OmniGraffle（Mac）、StarUML（支持架构图）；
* 代码生成：用 Mermaid 语法（支持 Markdown 嵌入，如上述文字版拓扑可转 Mermaid 图形）。
